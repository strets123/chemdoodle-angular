<!DOCTYPE html>
<html lang='en' >
  <head>
    <meta charset='utf-8'>
    <meta content='IE=edge' http-equiv='X-UA-Compatible'>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.20/angular.min.js"></script>

<!--     <link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" media="all" rel="stylesheet" />
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" media="screen" rel="stylesheet" /> -->
    <!--<link rel="stylesheet" href="//code.jquery.com/ui/1.11.1/themes/smoothness/jquery-ui.css">-->
<link rel="stylesheet" href="https://hub.chemdoodle.com/cwc/latest/ChemDoodleWeb.css">
<script src="https://hub.chemdoodle.com/cwc/latest/ChemDoodleWeb.js"></script>

<link rel="stylesheet" href="https://hub.chemdoodle.com/cwc/latest/uis/jquery-ui-1.10.3.custom.css">

<script src="https://hub.chemdoodle.com/cwc/latest/uis/ChemDoodleWeb-uis.js"></script>


    <style type="text/css" rel="stylesheet">
     
    </style>
  </head>
  <body ng-app='chemdoodleAngular' ng-controller="testChemDoodleAppController">
    {{molecule}}
     <chemdoodlewrapper  molfile="molecule.molfile" >
      <canvas id="chemdoodle"></canvas>
   </chemdoodlewrapper>

    
 
  </body>

  <script>
    var testChemDoodleApp =  angular.module('chemdoodleAngular', []);
  var elem = new ChemDoodle.SketcherCanvas('chemdoodle', 455, 300, {oneMolecule:true, includeToolbar:true, includeQuery:true});

    angular.module('chemdoodleAngular').controller('testChemDoodleAppController', function ($scope) {
        $scope.molecule = {"molfile": ""};

      });

 angular.module('chemdoodleAngular')
       .directive('chemdoodlewrapper', function () {
    return {
      restrict: 'E',
      scope:{'molfile' : '=' },
      link: function postLink(scope, element, attrs) {
        scope.setMol = function(){
          var molfile = ChemDoodle.writeMOL(elem.getMolecule()).valueOf();
          if(btoa(molfile) === "TW9sZWN1bGUgZnJvbSBDaGVtRG9vZGxlIFdlYiBDb21wb25lbnRzCgpodHRwOi8vd3d3LmljaGVtbGFicy5jb20KICAxICAwICAwICAwICAwICAwICAgICAgICAgICAgOTk5IFYyMDAwCiAgICAwLjAwMDAgICAgMC4wMDAwICAgIDAuMDAwMCBDICAgMCAgMCAgMCAgMCAgMCAgMApNICBFTkQ="){
            //check for methane - you can't search for methane
            scope.molfile = "";
          }else{
            scope.molfile = molfile;
            var mol = elem.getMolecule();
            angular.forEach(mol.atoms, function(a){
                // if(a.query){
                //   a.label = a.query.cache;
                //   console.log(ChemDoodle.writeMOL(mol));
                // }
            });


          }
        };
        element.bind ({
          click : function(e) {
            scope.$apply(scope.setMol);
          },
          keyup : function(e) {
            scope.$apply(scope.setMol);
          }
        });
      }
  }});

  </script>
</html>
